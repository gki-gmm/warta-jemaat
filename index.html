<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Warta Jemaat Online</title>

    <style>
        :root {
            --bg-color: #2c3e50;
            --paper-color: #fdfbf7;
            --shadow-strength: 0.4;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, #34495e 0%, #2c3e50 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: sans-serif;
            overflow: hidden; /* Mencegah scroll browser asli */
        }

        /* Loading Overlay */
        #loading {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-color);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            transition: opacity 0.5s;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Container Buku */
        .book-container {
            position: relative;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            transition: transform 0.3s ease;
        }

        #flipbook {
            display: none; /* Akan di-show via JS */
        }

        /* Styling Halaman (Page) */
        .page {
            background-color: var(--paper-color);
            overflow: hidden;
            /* Efek Kertas Realistis */
            border-left: 1px solid rgba(0,0,0,0.1); 
        }

        /* Shadow dalam halaman agar tidak terlalu putih polos */
        .page-wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(to right, rgba(0,0,0,0.05) 0%, rgba(255,255,255,0) 10%, rgba(255,255,255,0) 90%, rgba(0,0,0,0.05) 100%);
        }

        .page img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Mengisi halaman penuh */
            display: block;
        }

        /* Shadow dinamis saat membalik halaman (Turn.js classes) */
        .page.shadow {
            box-shadow: inset 0 0 30px rgba(0,0,0,0.1);
        }

        /* Controls Navigasi */
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            padding: 10px 20px;
            border-radius: 50px;
            display: flex;
            gap: 15px;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s;
        }

        .controls.active {
            opacity: 1;
            pointer-events: all;
        }

        .btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .btn:hover {
            background: rgba(255,255,255,0.2);
        }

        /* Pesan Error */
        #error-msg {
            display: none;
            text-align: center;
            color: #ff6b6b;
            padding: 20px;
            max-width: 400px;
        }
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loading">
        <div class="spinner"></div>
        <div id="loading-text">Memuat Buku...</div>
    </div>

    <!-- Error Message -->
    <div id="error-msg">
        <h3>File Tidak Ditemukan</h3>
        <p>Pastikan Anda memiliki file bernama <strong>WARTA JEMAAT GKI GMM EDISI 16 Tahun ke-22 (04-01-2026)</strong> di folder ini.</p>
    </div>

    <!-- Area Buku -->
    <div class="book-container">
        <div id="flipbook">
            <!-- Halaman akan digenerate otomatis -->
        </div>
    </div>

    <!-- Tombol Navigasi -->
    <div class="controls" id="controls">
        <button class="btn" onclick="prevPage()">&#10094;</button>
        <button class="btn" onclick="nextPage()">&#10095;</button>
    </div>

    <!-- Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <script>
        // --- KONFIGURASI ---
        const PDF_FILENAME = 'WARTA JEMAAT GKI GMM EDISI 16 Tahun ke-22 (04-01-2026).pdf'; // Nama file PDF Anda
        const BASE_WIDTH_DESKTOP = 900; // Lebar total buku di desktop (2 halaman)
        const BASE_WIDTH_MOBILE = 100;  // Lebar persentase layar di mobile
        const SCALE_QUALITY = 1.5;      // Kualitas render gambar (1.5 = retina ready)
        
        // --- STATE ---
        let pdfDoc = null;
        let bookWidth = 0;
        let bookHeight = 0;
        let isMobile = window.innerWidth <= 768;

        // Setup Worker PDF.js
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        $(document).ready(async function() {
            await loadPdf();
        });

        // Fungsi Utama Load PDF
        async function loadPdf() {
            try {
                // Coba ambil file WARTA JEMAAT GKI GMM EDISI 16 Tahun ke-22 (04-01-2026)
                const loadingTask = pdfjsLib.getDocument(PDF_FILENAME);
                pdfDoc = await loadingTask.promise;
                
                updateLoadingText(`Menemukan ${pdfDoc.numPages} halaman. Merender...`);
                
                // Render semua halaman ke dalam DOM
                await renderAllPages(pdfDoc);
                
                // Setup Buku setelah halaman siap
                setupBook();
                
                // Sembunyikan loading, tampilkan kontrol
                $('#loading').fadeOut();
                $('#controls').addClass('active');

            } catch (error) {
                console.error(error);
                $('#loading').hide();
                $('#error-msg').show();
            }
        }

        // Render Halaman
        async function renderAllPages(pdf) {
            const flipbook = $('#flipbook');
            flipbook.empty(); // Bersihkan
            
            // Kita ambil halaman 1 dulu untuk mengetahui aspect ratio
            const page1 = await pdf.getPage(1);
            const viewport = page1.getViewport({ scale: SCALE_QUALITY });
            
            // Hitung rasio (tinggi / lebar)
            const aspectRatio = viewport.height / viewport.width;

            // Tentukan ukuran dasar
            if (isMobile) {
                // Di mobile: lebar hampir fullscreen, tinggi menyesuaikan
                bookWidth = window.innerWidth - 20; 
                bookHeight = bookWidth * aspectRatio;
            } else {
                // Di desktop: lebar fix (misal 900px), tinggi menyesuaikan
                bookWidth = BASE_WIDTH_DESKTOP;
                bookHeight = bookWidth * (aspectRatio / 2); // Karena 2 halaman jadi satu
            }

            // Loop render semua halaman
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                
                // Canvas sementara untuk render
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                
                // Jika mobile, scale harus disesuaikan agar tajam di lebar layar
                // Jika desktop, scale disesuaikan dengan setengah lebar buku
                const pageRenderWidth = isMobile ? bookWidth * SCALE_QUALITY : (bookWidth / 2) * SCALE_QUALITY;
                const newViewport = page.getViewport({ scale: SCALE_QUALITY * (pageRenderWidth / viewport.width) });

                canvas.height = newViewport.height;
                canvas.width = newViewport.width;

                await page.render({ canvasContext: context, viewport: newViewport }).promise;
                
                const imgData = canvas.toDataURL('image/jpeg', 0.9);
                
                // Buat elemen HTML
                const div = document.createElement('div');
                div.className = 'page';
                div.style.width = isMobile ? bookWidth + 'px' : (bookWidth / 2) + 'px';
                div.style.height = bookHeight + 'px';
                
                const img = document.createElement('img');
                img.src = imgData;
                
                div.appendChild(img);
                flipbook.append(div);
                
                updateLoadingText(`Merender halaman ${i}/${pdf.numPages}...`);
            }
        }

        // Setup Turn.js
        function setupBook() {
            const flipbook = $('#flipbook');
            
            // Hapus instance lama jika ada
            if (flipbook.data('turn')) {
                flipbook.turn("destroy");
            }

            flipbook.turn({
                width: bookWidth,
                height: bookHeight,
                autoCenter: true,
                duration: 1200,       // Lebih lambat = lebih elegan
                acceleration: true,   // Percepatan di akhir flip
                gradients: true,      // Efek shading saat berbalik
                elevation: 50,        // Ketinggian saat mencengkeram kertas
                when: {
                    turning: function(e, page, view) {
                        // Logika tambahan saat balik halaman
                    }
                }
            });

            // Tentukan tampilan single/double
            if (isMobile) {
                flipbook.turn("display", "single");
            } else {
                flipbook.turn("display", "double");
            }
        }

        // Update Loading Text
        function updateLoadingText(msg) {
            $('#loading-text').text(msg);
        }

        // Navigasi
        window.prevPage = function() {
            $("#flipbook").turn("previous");
        }
        window.nextPage = function() {
            $("#flipbook").turn("next");
        }

        // Handle Resize (Responsive Switching)
        let resizeTimeout;
        $(window).resize(function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(handleResize, 300);
        });

        function handleResize() {
            const newIsMobile = window.innerWidth <= 768;
            
            // Jika status berubah (Mobile -> Desktop atau sebaliknya)
            if (newIsMobile !== isMobile) {
                isMobile = newIsMobile;
                // Kita perlu reload halaman untuk mengubah ukuran render secara bersih
                // Atau kita bisa coba resize turn.js, tapi render ulang lebih aman untuk resolusi gambar.
                location.reload(); 
            } else {
                // Jika hanya sedikit perubahan ukuran di mode yang sama, centering ulang saja
                $("#flipbook").turn("center");
            }
        }
    </script>
</body>
</html>

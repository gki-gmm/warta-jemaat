<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Protected Flipbook</title>
    
    <link rel="icon" href="data:,">

    <style>
        :root {
            --bg-color: #2c3e50;
            --paper-color: #fdfbf7;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at center, #34495e 0%, #2c3e50 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: sans-serif;
            overflow: hidden;
        }

        /* --- PASSWORD MODAL STYLE --- */
        #password-modal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }

        .modal-box {
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            color: #333;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .modal-box h2 { margin-top: 0; }

        #pass-input {
            width: 80%;
            padding: 10px;
            margin: 15px 0;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            text-align: center;
        }

        #pass-btn {
            padding: 10px 25px;
            background: #2c3e50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        #pass-btn:hover { background: #34495e; }

        #error-msg {
            color: red;
            font-size: 14px;
            margin-top: 10px;
            display: none;
        }

        /* Animasi goyang jika password salah */
        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            50% { transform: translateX(10px); }
            75% { transform: translateX(-10px); }
            100% { transform: translateX(0); }
        }

        /* --- END PASSWORD STYLE --- */

        /* Loading Screen (Muncul setelah password benar) */
        #loading {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--bg-color);
            display: none; /* Disembunyikan dulu sampai password benar */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9998;
            color: white;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Container Buku */
        .book-container {
            position: relative;
            box-shadow: 0 25px 60px rgba(0,0,0,0.6);
            /* Pastikan user bisa men-select teks jika ada, tapi untuk buku gambar biasanya tidak perlu */
            user-select: none; 
        }

        #flipbook {
            display: none; /* Disembunyikan sampai gambar siap */
            cursor: pointer; /* Indikasi bisa diklik */
        }

        /* Styling Halaman */
        .page {
            background-color: var(--paper-color);
            overflow: hidden;
        }

        .page img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Agar gambar tidak gepeng */
            display: block;
            pointer-events: none; /* Mencegah drag & drop gambar browser asli */
        }

        /* Shadow effect untuk kedalaman */
        .page {
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body>

    <!-- 1. MODAL PASSWORD (Muncul paling awal) -->
    <div id="password-modal">
        <div class="modal-box">
            <h2>Akses Terbatas</h2>
            <p>Masukkan password untuk membuka buku.</p>
            <input type="password" id="pass-input" placeholder="Password..." onkeypress="handleEnter(event)">
            <br>
            <button id="pass-btn" onclick="checkPassword()">Buka Buku</button>
            <div id="error-msg">Password salah!</div>
        </div>
    </div>

    <!-- 2. LOADING SCREEN (Muncul setelah password benar) -->
    <div id="loading">
        <div class="spinner"></div>
        <div id="loading-text">Memuat Buku...</div>
    </div>

    <!-- 3. ERROR JIKA GAMBAR HILANG -->
    <div id="img-error-msg" style="display:none; position:absolute; color:white; text-align:center;">
        <h3>Gagal Memuat</h3>
        <p>Pastikan folder 'img' ada dan berisi gambar.</p>
    </div>

    <!-- 4. AREA BUKU -->
    <div class="book-container">
        <div id="flipbook">
            <!-- Halaman akan di-generate otomatis -->
        </div>
    </div>

    <!-- LIBRARIES -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/turn.js/3/turn.min.js"></script>
    <!-- Library tambahan untuk fitur SWIPE (Usap) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-touchswipe/1.6.19/jquery.touchSwipe.min.js"></script>

    <script>
        // ==========================================
        // KONFIGURASI
        // ==========================================
        const CONFIG = {
            folderName: 'img',
            totalImages: 25,         // Sesuaikan jumlah gambar Anda (1.jpg sampai 25.jpg)
            fileExtension: '.jpg',
            baseWidth: 900,
            password: '150903'         // GANTI PASSWORD ANDA DI SINI
        };

        // ==========================================
        // LOGIKA PROGRAM
        // ==========================================
        
        let bookWidth = 0;
        let bookHeight = 0;
        let isMobile = window.innerWidth <= 768;

        // Fungsi Cek Password
        function checkPassword() {
            const input = $('#pass-input').val();
            const errorMsg = $('#error-msg');
            const modalBox = $('.modal-box');

            if (input === CONFIG.password) {
                // Password Benar
                $('#password-modal').fadeOut(300, function() {
                    // Mulai proses loading buku
                    $('#loading').show();
                    initBook();
                });
            } else {
                // Password Salah
                errorMsg.show();
                modalBox.addClass('shake');
                setTimeout(() => {
                    modalBox.removeClass('shake');
                }, 500);
            }
        }

        // Handle Enter key pada input password
        function handleEnter(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        }

        // Inisialisasi Buku (Dipanggil setelah password benar)
        function initBook() {
            const flipbook = $('#flipbook');
            const loadingText = $('#loading-text');

            // 1. Preload Gambar Pertama untuk mengetahui Aspek Rasio
            const firstImgPath = `${CONFIG.folderName}/1${CONFIG.fileExtension}`;
            const tempImg = new Image();
            
            tempImg.src = firstImgPath;
            
            tempImg.onload = function() {
                const aspectRatio = this.naturalHeight / this.naturalWidth;

                // Tentukan Ukuran Buku
                if (isMobile) {
                    bookWidth = window.innerWidth - 30; 
                    bookHeight = bookWidth * aspectRatio;
                } else {
                    bookWidth = CONFIG.baseWidth;
                    bookHeight = bookWidth * (aspectRatio / 2);
                }

                // 2. Generate Halaman ke DOM
                generatePages(aspectRatio);

                // 3. Inisialisasi Turn.js
                setupTurnJs();
                
                // 4. Tampilkan Buku & Sembunyikan Loading
                flipbook.show();
                $('#loading').fadeOut();
            };

            tempImg.onerror = function() {
                $('#loading').hide();
                $('#img-error-msg').show();
                console.error("Gagal memuat gambar pertama: " + firstImgPath);
            };
        }

        function generatePages(aspectRatio) {
            const flipbook = $('#flipbook');
            const loadingText = $('#loading-text');
            flipbook.empty();

            for (let i = 1; i <= CONFIG.totalImages; i++) {
                const imgPath = `${CONFIG.folderName}/${i}${CONFIG.fileExtension}`;
                
                const pageDiv = document.createElement('div');
                pageDiv.className = 'page';
                
                const pageWidth = isMobile ? bookWidth : (bookWidth / 2);
                pageDiv.style.width = pageWidth + 'px';
                pageDiv.style.height = bookHeight + 'px';

                const img = document.createElement('img');
                img.src = imgPath;
                img.alt = `Halaman ${i}`;
                img.loading = "lazy"; // Lazy load untuk performa lebih baik
                
                img.onload = function() {
                    loadingText.text(`Memuat Halaman ${i}/${CONFIG.totalImages}...`);
                };
                img.onerror = function() {
                    console.warn(`Gambar ${i} tidak ditemukan.`);
                };

                pageDiv.appendChild(img);
                flipbook.append(pageDiv);
            }
        }

        function setupTurnJs() {
            const flipbook = $('#flipbook');
            
            flipbook.turn({
                width: bookWidth,
                height: bookHeight,
                autoCenter: true,
                duration: 800,
                acceleration: true,
                gradients: true,
                elevation: 50,
                display: isMobile ? "single" : "double",
                when: {
                    turning: function(e, page, view) {
                        // Log tambahan jika diperlukan
                    }
                }
            });

            // --- TAMBAHAN: FITUR SWIPE (USAP) ---
            // Menggunakan library jQuery TouchSwipe
            flipbook.swipe({
                swipeLeft: function(event, direction, distance, duration, fingerCount) {
                    // Usap ke kiri = Halaman Selanjutnya (Next)
                    $(this).turn("next");
                },
                swipeRight: function(event, direction, distance, duration, fingerCount) {
                    // Usap ke kanan = Halaman Sebelumnya (Prev)
                    $(this).turn("previous");
                },
                // Konfigurasi agar tidak bentrok dengan klik mouse
                threshold: 50, // Minimal jarak usap (pixel)
                fingers: 'all'
            });
        }

        // Handle Window Resize
        let resizeTimeout;
        $(window).resize(function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                const newIsMobile = window.innerWidth <= 768;
                // Reload hanya jika mode berubah drastis
                if (newIsMobile !== isMobile) {
                    location.reload(); 
                }
            }, 300);
        });

    </script>
</body>
</html>